<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.31.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">
    <changeSet id="1749569803119-1" author="dusch">
        <createSequence incrementBy="50" sequenceName="import_result_seq" startValue="1"/>
    </changeSet>
    <changeSet id="1749569803119-2" author="dusch">
        <createTable tableName="ags">
            <column name="uuid" type="UUID"/>
            <column name="importing_file_identifier" type="VARCHAR(255)"/>
            <column name="created_at" type="DATETIME"/>
            <column name="modified_at" type="DATETIME"/>
            <column name="version" type="DATETIME"/>
            <column name="kg_datum" type="VARCHAR(255)"/>
            <column name="kg_name" type="VARCHAR(255)"/>
            <column name="kg_schluessel" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_ags"/>
            </column>
            <column name="kg_satzart" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_ags"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1749569803119-3" author="dusch">
        <createTable tableName="import_result">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_importresult"/>
            </column>
            <column name="file_name" type="VARCHAR(255)"/>
            <column name="import_date" type="DATETIME"/>
            <column name="import_successful" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="duration" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet id="1749569803119-4" author="dusch">
        <createTable tableName="ort">
            <column name="uuid" type="UUID"/>
            <column name="importing_file_identifier" type="VARCHAR(255)"/>
            <column name="created_at" type="DATETIME"/>
            <column name="modified_at" type="DATETIME"/>
            <column name="version" type="DATETIME"/>
            <column name="ort_datum" type="VARCHAR(255)"/>
            <column name="ort_oname" type="VARCHAR(255)"/>
            <column name="ort_oname_post" type="VARCHAR(255)"/>
            <column name="ort_ozusatz" type="VARCHAR(255)"/>
            <column name="ort_art_ozusatz" type="VARCHAR(255)"/>
            <column name="ort_oname24" type="VARCHAR(255)"/>
            <column name="ort_kgs" type="VARCHAR(255)"/>
            <column name="ort_alort_neu" type="VARCHAR(255)"/>
            <column name="outdated_at" type="DATETIME"/>
            <column name="already_applied_at" type="DATETIME"/>
            <column name="ort_alort" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_ort"/>
            </column>
            <column name="ort_status" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_ort"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1749569803119-5" author="dusch">
        <createTable tableName="ortsteil">
            <column name="uuid" type="UUID"/>
            <column name="importing_file_identifier" type="VARCHAR(255)"/>
            <column name="created_at" type="DATETIME"/>
            <column name="modified_at" type="DATETIME"/>
            <column name="version" type="DATETIME"/>
            <column name="otl_datum" type="VARCHAR(255)"/>
            <column name="otl_stverz" type="VARCHAR(255)"/>
            <column name="otl_name" type="VARCHAR(255)"/>
            <column name="otl_kgs" type="VARCHAR(255)"/>
            <column name="outdated_at" type="DATETIME"/>
            <column name="already_applied_at" type="DATETIME"/>
            <column name="otl_alort" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_ortsteil"/>
            </column>
            <column name="otl_schl" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_ortsteil"/>
            </column>
            <column name="otl_plz" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_ortsteil"/>
            </column>
            <column name="otl_status" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_ortsteil"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1749569803119-6" author="dusch">
        <createTable tableName="plz">
            <column name="uuid" type="UUID"/>
            <column name="importing_file_identifier" type="VARCHAR(255)"/>
            <column name="created_at" type="DATETIME"/>
            <column name="modified_at" type="DATETIME"/>
            <column name="version" type="DATETIME"/>
            <column name="plz_datum" type="VARCHAR(255)"/>
            <column name="plz_art_kardinalitÃ¤t" type="VARCHAR(255)"/>
            <column name="plz_art_auslierferung" type="VARCHAR(255)"/>
            <column name="plz_stverz" type="VARCHAR(255)"/>
            <column name="plz_pfverz" type="VARCHAR(255)"/>
            <column name="plz_oname" type="VARCHAR(255)"/>
            <column name="plz_ozusatz" type="VARCHAR(255)"/>
            <column name="plz_art_ozusatz" type="VARCHAR(255)"/>
            <column name="plz_oname24" type="VARCHAR(255)"/>
            <column name="plz_postlag" type="VARCHAR(255)"/>
            <column name="plz_la_brief" type="VARCHAR(255)"/>
            <column name="plz_la_alort" type="VARCHAR(255)"/>
            <column name="plz_kgs" type="VARCHAR(255)"/>
            <column name="plz_ort_code" type="VARCHAR(255)"/>
            <column name="plz_leitcode_max" type="VARCHAR(255)"/>
            <column name="plz_rabatt_info_schwer" type="VARCHAR(255)"/>
            <column name="plz_reserve" type="VARCHAR(255)"/>
            <column name="plz_fz_nr" type="VARCHAR(255)"/>
            <column name="plz_bz_nr" type="VARCHAR(255)"/>
            <column name="plz_plz" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_plz"/>
            </column>
            <column name="plz_alort" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_plz"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1749569803119-7" author="dusch">
        <createTable tableName="strasse">
            <column name="uuid" type="UUID"/>
            <column name="importing_file_identifier" type="VARCHAR(255)"/>
            <column name="created_at" type="DATETIME"/>
            <column name="modified_at" type="DATETIME"/>
            <column name="version" type="DATETIME"/>
            <column name="str_datum" type="VARCHAR(255)"/>
            <column name="str_stverz" type="VARCHAR(255)"/>
            <column name="str_name_sort" type="VARCHAR(255)"/>
            <column name="str_name46" type="VARCHAR(255)"/>
            <column name="str_name22" type="VARCHAR(255)"/>
            <column name="str_reserve" type="VARCHAR(255)"/>
            <column name="str_hnr_typ" type="VARCHAR(255)"/>
            <column name="str_plz" type="VARCHAR(255)"/>
            <column name="str_code" type="VARCHAR(255)"/>
            <column name="str_otl_schl" type="VARCHAR(255)"/>
            <column name="str_alorgb" type="VARCHAR(255)"/>
            <column name="str_kgs" type="VARCHAR(255)"/>
            <column name="str_alort_neu" type="VARCHAR(255)"/>
            <column name="str_namen_schl_neu" type="VARCHAR(255)"/>
            <column name="str_bund_lfdnr_neu" type="VARCHAR(255)"/>
            <column name="str_hnrvon_neu" type="VARCHAR(255)"/>
            <column name="str_hnrbis_neu" type="VARCHAR(255)"/>
            <column name="outdated_at" type="DATETIME"/>
            <column name="already_applied_at" type="DATETIME"/>
            <column name="str_alort" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_strasse"/>
            </column>
            <column name="str_namen_schl" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_strasse"/>
            </column>
            <column name="str_bund_lfdnr" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_strasse"/>
            </column>
            <column name="str_hnrvon" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_strasse"/>
            </column>
            <column name="str_hnrbis" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_strasse"/>
            </column>
            <column name="str_status" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_strasse"/>
            </column>
            <column name="str_hnr1000" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_strasse"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1749569803119-8" author="dusch">
        <createIndex indexName="IDX_AGS___UUID" tableName="ags">
            <column name="uuid"/>
        </createIndex>
    </changeSet>
    <changeSet id="1749569803119-9" author="dusch">
        <createIndex indexName="IDX_ORTSTEIL___UUID" tableName="ortsteil">
            <column name="uuid"/>
        </createIndex>
    </changeSet>
    <changeSet id="1749569803119-10" author="dusch">
        <createIndex indexName="IDX_ORT___UUID" tableName="ort">
            <column name="uuid"/>
        </createIndex>
    </changeSet>
    <changeSet id="1749569803119-11" author="dusch">
        <createIndex indexName="IDX_PLZ___UUID" tableName="plz">
            <column name="uuid"/>
        </createIndex>
    </changeSet>
    <changeSet id="1749569803119-12" author="dusch">
        <createIndex indexName="IDX_STRASSE___UUID" tableName="strasse">
            <column name="uuid"/>
        </createIndex>
    </changeSet>

    <changeSet id="1749569803119-13" author="dusch">
        <createView catalogName="cat"
                    encoding="UTF-8"
                    fullDefinition="false"
                    remarks="A String"
                    replaceIfExists="false"
                    schemaName="public"
                    viewName="v_processed_successionable_rows">
            SELECT o.uuid
            FROM ort o
            WHERE o.already_applied_at IS NOT NULL
               OR o.outdated_at IS NOT NULL
            UNION
            SELECT ot.uuid
            FROM ortsteil ot
            WHERE ot.already_applied_at IS NOT NULL
               OR ot.outdated_at IS NOT NULL
            UNION
            SELECT st.uuid
            FROM strasse st
            WHERE st.already_applied_at IS NOT NULL
               OR st.outdated_at IS NOT NULL;
        </createView>
    </changeSet>

</databaseChangeLog>