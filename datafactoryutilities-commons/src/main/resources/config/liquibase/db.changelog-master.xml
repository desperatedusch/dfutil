<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.31.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">
    <changeSet id="1749934603783-1" author="dusch">
        <createSequence incrementBy="50" sequenceName="import_result_seq" startValue="1"/>
    </changeSet>
    <changeSet id="1749934603783-2" author="dusch">
        <createTable tableName="import_result">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_import_result"/>
            </column>
            <column name="file_name" type="VARCHAR(255)"/>
            <column name="import_date" type="DATETIME"/>
            <column name="import_successful" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="duration" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet id="1749934603783-3" author="dusch">
        <createTable tableName="kg_row">
            <column name="uuid" type="UUID"/>
            <column name="importing_file_identifier" type="VARCHAR(255)"/>
            <column name="created_at" type="DATETIME"/>
            <column name="modified_at" type="DATETIME"/>
            <column name="version" type="DATETIME"/>
            <column name="kg_datum" type="VARCHAR(255)"/>
            <column name="kg_name" type="VARCHAR(255)"/>
            <column name="kg_schluessel" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_kg_row"/>
            </column>
            <column name="kg_satzart" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_kg_row"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1749934603783-4" author="dusch">
        <createTable tableName="or_row">
            <column name="uuid" type="UUID"/>
            <column name="importing_file_identifier" type="VARCHAR(255)"/>
            <column name="created_at" type="DATETIME"/>
            <column name="modified_at" type="DATETIME"/>
            <column name="version" type="DATETIME"/>
            <column name="ort_datum" type="VARCHAR(255)"/>
            <column name="ort_oname" type="VARCHAR(255)"/>
            <column name="ort_oname_post" type="VARCHAR(255)"/>
            <column name="ort_ozusatz" type="VARCHAR(255)"/>
            <column name="ort_art_ozusatz" type="VARCHAR(255)"/>
            <column name="ort_oname24" type="VARCHAR(255)"/>
            <column name="ort_kgs" type="VARCHAR(255)"/>
            <column name="ort_alort_neu" type="VARCHAR(255)"/>
            <column name="outdated_at" type="DATETIME"/>
            <column name="already_applied_at" type="DATETIME"/>
            <column name="ort_alort" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_or_row"/>
            </column>
            <column name="ort_status" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_or_row"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1749934603783-5" author="dusch">
        <createTable tableName="ot_row">
            <column name="uuid" type="UUID"/>
            <column name="importing_file_identifier" type="VARCHAR(255)"/>
            <column name="created_at" type="DATETIME"/>
            <column name="modified_at" type="DATETIME"/>
            <column name="version" type="DATETIME"/>
            <column name="otl_datum" type="VARCHAR(255)"/>
            <column name="otl_stverz" type="VARCHAR(255)"/>
            <column name="otl_name" type="VARCHAR(255)"/>
            <column name="otl_kgs" type="VARCHAR(255)"/>
            <column name="outdated_at" type="DATETIME"/>
            <column name="already_applied_at" type="DATETIME"/>
            <column name="otl_alort" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_ot_row"/>
            </column>
            <column name="otl_schl" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_ot_row"/>
            </column>
            <column name="otl_plz" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_ot_row"/>
            </column>
            <column name="otl_status" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_ot_row"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1749934603783-6" author="dusch">
        <createTable tableName="pl_row">
            <column name="uuid" type="UUID"/>
            <column name="importing_file_identifier" type="VARCHAR(255)"/>
            <column name="created_at" type="DATETIME"/>
            <column name="modified_at" type="DATETIME"/>
            <column name="version" type="DATETIME"/>
            <column name="plz_datum" type="VARCHAR(255)"/>
            <column name="plz_art_kardinalität" type="VARCHAR(255)"/>
            <column name="plz_art_auslierferung" type="VARCHAR(255)"/>
            <column name="plz_stverz" type="VARCHAR(255)"/>
            <column name="plz_pfverz" type="VARCHAR(255)"/>
            <column name="plz_oname" type="VARCHAR(255)"/>
            <column name="plz_ozusatz" type="VARCHAR(255)"/>
            <column name="plz_art_ozusatz" type="VARCHAR(255)"/>
            <column name="plz_oname24" type="VARCHAR(255)"/>
            <column name="plz_postlag" type="VARCHAR(255)"/>
            <column name="plz_la_brief" type="VARCHAR(255)"/>
            <column name="plz_la_alort" type="VARCHAR(255)"/>
            <column name="plz_kgs" type="VARCHAR(255)"/>
            <column name="plz_ort_code" type="VARCHAR(255)"/>
            <column name="plz_leitcode_max" type="VARCHAR(255)"/>
            <column name="plz_rabatt_info_schwer" type="VARCHAR(255)"/>
            <column name="plz_reserve" type="VARCHAR(255)"/>
            <column name="plz_fz_nr" type="VARCHAR(255)"/>
            <column name="plz_bz_nr" type="VARCHAR(255)"/>
            <column name="plz_plz" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_pl_row"/>
            </column>
            <column name="plz_alort" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_pl_row"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1749934603783-7" author="dusch">
        <createTable tableName="sb_row">
            <column name="uuid" type="UUID"/>
            <column name="importing_file_identifier" type="VARCHAR(255)"/>
            <column name="created_at" type="DATETIME"/>
            <column name="modified_at" type="DATETIME"/>
            <column name="version" type="DATETIME"/>
            <column name="str_datum" type="VARCHAR(255)"/>
            <column name="str_stverz" type="VARCHAR(255)"/>
            <column name="str_name_sort" type="VARCHAR(255)"/>
            <column name="str_name46" type="VARCHAR(255)"/>
            <column name="str_name22" type="VARCHAR(255)"/>
            <column name="str_reserve" type="VARCHAR(255)"/>
            <column name="str_hnr_typ" type="VARCHAR(255)"/>
            <column name="str_plz" type="VARCHAR(255)"/>
            <column name="str_code" type="VARCHAR(255)"/>
            <column name="str_otl_schl" type="VARCHAR(255)"/>
            <column name="str_alorgb" type="VARCHAR(255)"/>
            <column name="str_kgs" type="VARCHAR(255)"/>
            <column name="str_alort_neu" type="VARCHAR(255)"/>
            <column name="str_namen_schl_neu" type="VARCHAR(255)"/>
            <column name="str_bund_lfdnr_neu" type="VARCHAR(255)"/>
            <column name="str_hnrvon_neu" type="VARCHAR(255)"/>
            <column name="str_hnrbis_neu" type="VARCHAR(255)"/>
            <column name="outdated_at" type="DATETIME"/>
            <column name="already_applied_at" type="DATETIME"/>
            <column name="str_alort" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_sb_row"/>
            </column>
            <column name="str_namen_schl" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_sb_row"/>
            </column>
            <column name="str_bund_lfdnr" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_sb_row"/>
            </column>
            <column name="str_hnrvon" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_sb_row"/>
            </column>
            <column name="str_hnrbis" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_sb_row"/>
            </column>
            <column name="str_status" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_sb_row"/>
            </column>
            <column name="str_hnr1000" type="VARCHAR(255)">
                <constraints primaryKey="true" primaryKeyName="pk_sb_row"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1749934603783-8" author="dusch">
        <createTable tableName="successionstate_link">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_successionstate_link"/>
            </column>
            <column name="uuid" type="UUID">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1749934603783-9" author="dusch">
        <createTable tableName="successionstate_predecessor">
            <column name="predecessor_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_successionstate_predecessor"/>
            </column>
            <column name="successionstate_link_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_successionstate_predecessor"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1749934603783-10" author="dusch">
        <createIndex indexName="IDX_AGS___UUID" tableName="kg_row">
            <column name="uuid"/>
        </createIndex>
    </changeSet>
    <changeSet id="1749934603783-11" author="dusch">
        <createIndex indexName="IDX_ORTSTEIL___UUID" tableName="ot_row">
            <column name="uuid"/>
        </createIndex>
    </changeSet>
    <changeSet id="1749934603783-12" author="dusch">
        <createIndex indexName="IDX_ORT___UUID" tableName="or_row">
            <column name="uuid"/>
        </createIndex>
    </changeSet>
    <changeSet id="1749934603783-13" author="dusch">
        <createIndex indexName="IDX_PLZ___UUID" tableName="pl_row">
            <column name="uuid"/>
        </createIndex>
    </changeSet>
    <changeSet id="1749934603783-14" author="dusch">
        <createIndex indexName="IDX_STRASSE___UUID" tableName="sb_row">
            <column name="uuid"/>
        </createIndex>
    </changeSet>
    <changeSet id="1749934603783-15" author="dusch">
        <addForeignKeyConstraint baseColumnNames="predecessor_id" baseTableName="successionstate_predecessor"
                                 constraintName="fk_sucpre_on_predecessor" referencedColumnNames="id"
                                 referencedTableName="successionstate_link"/>
    </changeSet>
    <changeSet id="1749934603783-16" author="dusch">
        <addForeignKeyConstraint baseColumnNames="successionstate_link_id" baseTableName="successionstate_predecessor"
                                 constraintName="fk_sucpre_on_successionstate_link" referencedColumnNames="id"
                                 referencedTableName="successionstate_link"/>
    </changeSet>
    <changeSet id="1749934603783-17" author="dusch">
        <createView catalogName="cat"
                    encoding="UTF-8"
                    fullDefinition="false"
                    remarks="A String"
                    replaceIfExists="true"
                    schemaName="public"
                    viewName="already_processed_successionable_rows">
            SELECT 'Ort'::text AS "Typ", ort.uuid,
                   ort.ort_status         as "Status",
                   ort.already_applied_at as "bereits verarbeitet am",
                   ort.outdated_at        as "abgelöst am"
            FROM or_row ort
            WHERE ort.already_applied_at IS NOT NULL
               OR ort.outdated_at IS NOT NULL
            UNION
            SELECT 'Ortsteil'::text , ot.uuid,
                   ot.otl_status         as "Status",
                   ot.already_applied_at as "bereits verarbeitet am",
                   ot.outdated_at        as "abgelöst am"
            FROM ot_row ot
            WHERE ot.already_applied_at IS NOT NULL
               OR ot.outdated_at IS NOT NULL
            UNION
            SELECT 'Strasse'::text, st.uuid,
                   st.str_status         as "Status",
                   st.already_applied_at as "bereits verarbeitet am",
                   st.outdated_at        as "abgelöst am"
            FROM sb_row st
            WHERE st.already_applied_at IS NOT NULL
               OR st.outdated_at IS NOT NULL;
        </createView>
    </changeSet>
</databaseChangeLog>
